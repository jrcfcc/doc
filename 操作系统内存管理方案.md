# 物理内存的空闲内存管理

###  内存分配管理

1. 空闲区表: 可变内存分配方案的管理
2. 位图:连续内存分配的管理

内碎片:分配给进程的内存中,有一页只用到了很少的部分,就产生了内碎片
外碎片:进程整体加载到物理内存时,产生的没法分配给进程的一些小内存片段	
	

### 内存管理方案

#### 一 连续内存分配方案:

##### 定长内存:

物理内存按固定长度划分
		内存分配有:first分配,位置继承分配
		内存分配算法:位图,0代表被其它进程占用,1代表可用

##### 可变内存:

内存分配算法:空闲区表:记录了每块内存的起始地址,内存大小,是否被其他程序占用

#### 二 非连续内存管理方案:

##### 页式存储管理:

-  用户进程地址空间按固定大小的页划分为几页,从0开始编号,一般页的大小为4k或者4m

- 物理内存按同样的固定长度分页,每页有页框号及该页的起始地址

- 内存分配按页分配

- 逻辑地址分为页号和页内偏移,32位操作系统,高的20位为页号,低的12位为偏移地址，系统自动划分

- 页表:记录进程的页号与物理内存页框的对应关系,页表保存在内存中

   页表项:

  1. 逻辑页号,在进程中的页号,从0开始
  2. 访问位 ,该页是否被访问过,页面置换时会优先置换长时间未被访问过的页面
  3. 驻留位 ,该页是否在物理内存中,如果是在内存中,则该页表项是有效的,负责访问该页表项时会产生缺页异常
  4. 保护位 ,该页是否可读,可写,可执行
  5. 修改位:该页是否被写过,如果被写过,则说明内存中的数据是最新的数据,如果要置换该页面,则需要先把该页内存中的数据刷到硬盘,避免数据不一致
  6. 物理页帧号,对应的物理页框号,寄存器在做地址转换时会用到

- 地址转化过程
   	   逻辑地址转化为物理地址的过程,cpu取到物理地址,自动划分为页号和页内偏移,先根据页号从页表中找到对应的物理内存页,然后把物理内存页的起始地址+页内偏移就得到了该逻辑地址对应的实际物理地址

##### 段式,

进程按程序逻辑分为几个程序段,每段有段号及段长,非定长,物理内存同样按段长划分,需要显示的计算出段号及内存大小
		段表:段号与物理内存段的对应关系

##### 段页式

​    先把进程按段划分,再把每段进程所需内存按页划分

伙伴系统

将所有的空闲页框分为11个块链表,每个块链表分别对应包含1,2,4,8,16,32,64,128,256,512,1024个连续页框的页框块，每个链表的起始页框的物理地址是该页框块大小的整数倍。最大可以申请1024个连续页框,也就是4MB大小的内存。当某个程序需要申请128个页框大小的内存时,先去128对应的链表上找,如果没有,则从256个页框大小的链表中去一块出来分成2个128大小的页框块,一块给程序使用,一块则移到128大小的链表中

MMU (Memory Management Unit) 内存管理单元

包括内存映射寄存器,将逻辑地址转换为物理地址,地址边界保护,防止越界访问